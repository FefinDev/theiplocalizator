<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>TheIPLocalizator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #2a2a40);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .card {
      background: #12121c;
      border-radius: 16px;
      padding: 24px;
      width: 100%;
      max-width: 460px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }

    h1 {
      text-align: center;
      margin-top: 0;
    }

    .input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
    }

    button {
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: #4f46e5;
      color: white;
      cursor: pointer;
    }

    button.secondary {
      background: #2e2e44;
      width: 100%;
      margin-bottom: 10px;
    }

    .result {
      background: #1b1b2b;
      border-radius: 12px;
      padding: 14px;
      margin-top: 12px;
      white-space: pre-line;
      font-size: 0.95rem;
    }

    #map {
      height: 220px;
      border-radius: 12px;
      margin-top: 12px;
    }

    details {
      background: #181827;
      border-radius: 12px;
      padding: 12px;
      margin-top: 16px;
      font-size: 0.85rem;
      color: #ddd;
    }

    summary {
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .error {
      color: #ff6b6b;
      margin-top: 8px;
      text-align: center;
    }

    footer {
      text-align: center;
      margin-top: 12px;
      font-size: 0.75rem;
      color: #aaa;
    }
  </style>
</head>
<body>

<div class="card">
  <h1> TheIPLocalizator</h1>

  <div class="input-group">
    <input id="ipInput" placeholder="Ej: 8.8.8.8">
    <button onclick="buscarIP()">Buscar</button>
  </div>

  <button class="secondary" onclick="miIP()">Mi IP</button>

  <div id="result" class="result" style="display:none"></div>
  <div id="map" style="display:none"></div>
  <div class="result" id="ips" style="display:none"></div>

  <div id="error" class="error"></div>

  <details>
    <summary> Recomendaciones de seguridad</summary>
    <p>
      Al navegar por Internet, tu direcci贸n IP queda expuesta y puede ser utilizada
      para obtener informaci贸n aproximada sobre tu ubicaci贸n o proveedor de servicio.
      En manos equivocadas, estos datos pueden representar un riesgo para tu privacidad.
    </p>
    <p>
      Se recomienda evitar el acceso a sitios web de dudosa procedencia y adoptar
      medidas adicionales de protecci贸n, como el uso de una VPN confiable o
      navegadores orientados a la privacidad, como Tor Browser.</p>
  </details>

  <footer>
    Ubicaci贸n aproximada 路 No es GPS 路 Puede fallar con VPN/Tor
  </footer>
</div>

<script>
  const result = document.getElementById("result");
  const error = document.getElementById("error");
  const mapDiv = document.getElementById("map");
  const ipsDiv = document.getElementById("ips");

  let map, marker;

  // Obtiene SIEMPRE las IPs reales del usuario
  function cargarIPsUsuario() {
    fetch("https://ipapi.co/json/")
      .then(r => r.json())
      .then(data => {
        ipsDiv.style.display = "block";
        ipsDiv.textContent =
`Tu IPv4 es: ${data.ip || "No disponible"}
Tu IPv6 es: ${data.ipv6 || "No disponible"}`;
      });
  }

  cargarIPsUsuario();

  function mostrar(data) {
    const direccion = `${data.city || "?"}, ${data.region || "?"}, ${data.country_name || "?"}`;

    result.style.display = "block";
    result.textContent =
`Direcci贸n aproximada:
${direccion}

ISP: ${data.org || "?"}`;

    if (data.latitude && data.longitude) {
      mapDiv.style.display = "block";

      if (!map) {
        map = L.map("map").setView([data.latitude, data.longitude], 10);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution: "漏 OpenStreetMap"
        }).addTo(map);
        marker = L.marker([data.latitude, data.longitude]).addTo(map);
      } else {
        map.setView([data.latitude, data.longitude], 10);
        marker.setLatLng([data.latitude, data.longitude]);
      }
    }
  }

  function buscarIP() {
    const ip = document.getElementById("ipInput").value.trim();
    if (!ip) {
      error.textContent = "Ingres谩 una IP v谩lida";
      return;
    }
    consultar(ip);
  }

  function miIP() {
    consultar("");
  }

  function consultar(ip) {
    error.textContent = "";
    result.style.display = "none";
    mapDiv.style.display = "none";

    fetch(`https://ipapi.co/${ip}/json/`)
      .then(r => r.json())
      .then(data => {
        if (data.error) throw new Error();
        mostrar(data);
      })
      .catch(() => {
        error.textContent = "No se pudo obtener la informaci贸n";
      });
  }
</script>

</body>
</html>
